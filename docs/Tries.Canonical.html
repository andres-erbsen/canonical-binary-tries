
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Tries.Canonical</title>
<meta name="description" content="Documentation of Coq module Tries.Canonical" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Tries.Canonical</h1>
<div class="coq">
<h1> The extensional binary tries based on a canonical representation </h1>
<br/>
<br/>
<span class="id">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.PArith.PArith.html">PArith</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html">FunctionalExtensionality</a></span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Unset</span> <span class="id">Elimination</span> <span class="id">Schemes</span>.<br/>
<span class="kwd">Local</span> <span class="kwd">Unset</span> <span class="id">Case</span> <span class="id">Analysis</span> <span class="id">Schemes</span>.<br/>
<br/>
<span class="kwd">Set</span> <span class="kwd">Implicit</span> <span class="id">Arguments</span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id"><a name="PTree">PTree</a></span>.<br/>
<br/>
<h2> Representation of tries </h2>
<br/>
<div class="doc">The type <span class="bracket"><span class="id">tree</span>'</span> of nonempty tries.  Each constructor is of the form
    <span class="bracket"><span class="id">NodeXYZ</span></span>, where the bit <span class="bracket"><span class="id">X</span></span> says whether there is a left subtree,
    <span class="bracket"><span class="id">Y</span></span> whether there is a value at this node, and <span class="bracket"><span class="id">Z</span></span> whether there is
    a right subtree. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id">tree</span>' (<span class="id">A</span>: <span class="kwd">Type</span>) : <span class="kwd">Type</span> := <br/>
| <span class="id"><a name="PTree.Node001">Node001</a></span>: <span class="id">tree</span>' <span class="id">A</span> -&gt; <span class="id">tree</span>' <span class="id">A</span><br/>
| <span class="id"><a name="PTree.Node010">Node010</a></span>: <span class="id">A</span> -&gt; <span class="id">tree</span>' <span class="id">A</span><br/>
| <span class="id"><a name="PTree.Node011">Node011</a></span>: <span class="id">A</span> -&gt; <span class="id">tree</span>' <span class="id">A</span> -&gt; <span class="id">tree</span>' <span class="id">A</span><br/>
| <span class="id"><a name="PTree.Node100">Node100</a></span>: <span class="id">tree</span>' <span class="id">A</span> -&gt; <span class="id">tree</span>' <span class="id">A</span><br/>
| <span class="id"><a name="PTree.Node101">Node101</a></span>: <span class="id">tree</span>' <span class="id">A</span> -&gt; <span class="id">tree</span>' <span class="id">A</span> -&gt;<span class="id">tree</span>' <span class="id">A</span><br/>
| <span class="id"><a name="PTree.Node110">Node110</a></span>: <span class="id">tree</span>' <span class="id">A</span> -&gt; <span class="id">A</span> -&gt; <span class="id">tree</span>' <span class="id">A</span><br/>
| <span class="id"><a name="PTree.Node111">Node111</a></span>: <span class="id">tree</span>' <span class="id">A</span> -&gt; <span class="id">A</span> -&gt; <span class="id">tree</span>' <span class="id">A</span> -&gt; <span class="id">tree</span>' <span class="id">A</span>.<br/>
<br/>
<div class="doc">The type <span class="bracket"><span class="id">tree</span></span> of tries, empty or nonempty. </div>
<br/>
<span class="kwd">Inductive</span> <span class="id"><a name="PTree.tree">tree</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) : <span class="kwd">Type</span> := <br/>
| <span class="id"><a name="PTree.Empty">Empty</a></span>: <span class="id">tree</span> <span class="id">A</span><br/>
| <span class="id"><a name="PTree.Nodes">Nodes</a></span>: <span class="id">tree</span>' <span class="id">A</span> -&gt; <span class="id">tree</span> <span class="id">A</span>.<br/>
<br/>
<span class="id">Arguments</span> <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> {<span class="id">A</span>} <span class="id">_</span>.<br/>
<span class="id">Arguments</span> <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> {<span class="id">A</span>} <span class="id">_</span>.<br/>
<span class="id">Arguments</span> <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> {<span class="id">A</span>} <span class="id">_</span> <span class="id">_</span>.<br/>
<span class="id">Arguments</span> <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> {<span class="id">A</span>} <span class="id">_</span>.<br/>
<span class="id">Arguments</span> <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> {<span class="id">A</span>} <span class="id">_</span> <span class="id">_</span>.<br/>
<span class="id">Arguments</span> <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> {<span class="id">A</span>} <span class="id">_</span> <span class="id">_</span>.<br/>
<span class="id">Arguments</span> <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> {<span class="id">A</span>} <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>.<br/>
<br/>
<span class="id">Arguments</span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> {<span class="id">A</span>}.<br/>
<span class="id">Arguments</span> <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> {<span class="id">A</span>} <span class="id">_</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="PTree.t">t</a></span> := <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span>.<br/>
<br/>
<span class="kwd">Scheme</span> <span class="id">tree</span>'<span class="id">_ind</span> := <span class="kwd">Induction</span> <span class="kwd">for</span> <span class="id">tree</span>' <span class="kwd">Sort</span> <span class="kwd">Prop</span>.<br/>
<br/>
<div class="doc">A smart constructor similar to the <span class="bracket"><span class="id">Node</span>'</span> smart constructor
    of the original implementation.  Given a (possibly empty) left subtree,
    a (possibly absent) value, and a (possibly empty) right subtree,
    it builds the corresponding tree. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="PTree.Node">Node</a></span> {<span class="id">A</span>} (<span class="id">l</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>) (<span class="id">o</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span>) (<span class="id">r</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>) : <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span> := <br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span>,<span class="id">o</span>,<span class="id">r</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>' =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r</span>')<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>' =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x</span> <span class="id">r</span>')<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l</span>')<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>' =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l</span>' <span class="id">r</span>')<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l</span>' <span class="id">x</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>', <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>' =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span>' <span class="id">x</span> <span class="id">r</span>')<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h2> Basic operations: <span class="bracket"><span class="id">empty</span></span>, <span class="bracket"><span class="id">get</span></span>, <span class="bracket"><span class="tactic">set</span></span>, <span class="bracket"><span class="id">remove</span></span> </h2>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="PTree.empty">empty</a></span> (<span class="id">A</span>: <span class="kwd">Type</span>) : <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span> := <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span>.<br/>
<br/>
<div class="doc">Operations such as <span class="bracket"><span class="id">get</span></span> follow a common pattern:
    first, a recursive function <span class="bracket"><span class="id">get</span>'</span> over nonempty tries;
    then, a non-recursive function <span class="bracket"><span class="id">get</span></span> to handle empty tries too. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">get</span>' {<span class="id">A</span>} (<span class="id">p</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">m</span>: <span class="id">tree</span>' <span class="id">A</span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span> :=<br/>
<span class="kwd">match</span> <span class="id">p</span>, <span class="id">m</span> <span class="kwd">with</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">_</span> <span class="id">x</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">_</span> <span class="id">x</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">m</span>' =&gt; <span class="id">get</span>' <span class="id">q</span> <span class="id">m</span>'<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">m</span>' <span class="id">_</span> =&gt; <span class="id">get</span>' <span class="id">q</span> <span class="id">m</span>'<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">m</span>' <span class="id">_</span> =&gt; <span class="id">get</span>' <span class="id">q</span> <span class="id">m</span>'<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">m</span>' <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">get</span>' <span class="id">q</span> <span class="id">m</span>'<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">m</span>' =&gt; <span class="id">get</span>' <span class="id">q</span> <span class="id">m</span>'<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">_</span> <span class="id">m</span>' =&gt; <span class="id">get</span>' <span class="id">q</span> <span class="id">m</span>'<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">m</span>' =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">_</span> <span class="id">m</span>' =&gt; <span class="id">get</span>' <span class="id">q</span> <span class="id">m</span>'<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">m</span>' =&gt; <span class="id">get</span>' <span class="id">q</span> <span class="id">m</span>'<br/>
<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="PTree.get">get</a></span> {<span class="id">A</span>} (<span class="id">p</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>) : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span> :=<br/>
<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
| <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span>' =&gt; <span class="id">get</span>' <span class="id">p</span> <span class="id">m</span>'<br/>
<span class="kwd">end</span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">set0</span> <span class="id">p</span> <span class="id">x</span></span> constructs the singleton trie that maps <span class="bracket"><span class="id">p</span></span> to <span class="bracket"><span class="id">x</span></span>
    and has no other bindings. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="PTree.set0">set0</a></span> {<span class="id">A</span>} (<span class="id">p</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">x</span>: <span class="id">A</span>) : <span class="id">tree</span>' <span class="id">A</span> :=<br/>
<span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> (<span class="id">set0</span> <span class="id">q</span> <span class="id">x</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> (<span class="id">set0</span> <span class="id">q</span> <span class="id">x</span>)<br/>
<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="tactic">set</span>' {<span class="id">A</span>} (<span class="id">p</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">x</span>: <span class="id">A</span>) (<span class="id">m</span>: <span class="id">tree</span>' <span class="id">A</span>) : <span class="id">tree</span>' <span class="id">A</span> :=<br/>
<span class="kwd">match</span> <span class="id">p</span>, <span class="id">m</span> <span class="kwd">with</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x</span> <span class="id">r</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">_</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x</span> <span class="id">r</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l</span> <span class="id">x</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span> <span class="id">x</span> <span class="id">r</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l</span> <span class="id">_</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l</span> <span class="id">x</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span> <span class="id">_</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span> <span class="id">x</span> <span class="id">r</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.set0">set0</a></span> <span class="id">q</span> <span class="id">x</span>) <span class="id">r</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">y</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.set0">set0</a></span> <span class="id">q</span> <span class="id">x</span>) <span class="id">y</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">y</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.set0">set0</a></span> <span class="id">q</span> <span class="id">x</span>) <span class="id">y</span> <span class="id">r</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> (<span class="tactic">set</span>' <span class="id">q</span> <span class="id">x</span> <span class="id">l</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> (<span class="tactic">set</span>' <span class="id">q</span> <span class="id">x</span> <span class="id">l</span>) <span class="id">r</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l</span> <span class="id">y</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> (<span class="tactic">set</span>' <span class="id">q</span> <span class="id">x</span> <span class="id">l</span>) <span class="id">y</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span> <span class="id">y</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> (<span class="tactic">set</span>' <span class="id">q</span> <span class="id">x</span> <span class="id">l</span>) <span class="id">y</span> <span class="id">r</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> (<span class="tactic">set</span>' <span class="id">q</span> <span class="id">x</span> <span class="id">r</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">y</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">y</span> (<span class="id"><a href="Tries.Canonical.html#PTree.set0">set0</a></span> <span class="id">q</span> <span class="id">x</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">y</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">y</span> (<span class="tactic">set</span>' <span class="id">q</span> <span class="id">x</span> <span class="id">r</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l</span> (<span class="id"><a href="Tries.Canonical.html#PTree.set0">set0</a></span> <span class="id">q</span> <span class="id">x</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l</span> (<span class="tactic">set</span>' <span class="id">q</span> <span class="id">x</span> <span class="id">r</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l</span> <span class="id">y</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span> <span class="id">y</span> (<span class="id"><a href="Tries.Canonical.html#PTree.set0">set0</a></span> <span class="id">q</span> <span class="id">x</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span> <span class="id">y</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span> <span class="id">y</span> (<span class="tactic">set</span>' <span class="id">q</span> <span class="id">x</span> <span class="id">r</span>)<br/>
<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="tactic">set</span> {<span class="id">A</span>} (<span class="id">p</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">x</span>: <span class="id">A</span>) (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>) : <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span> :=<br/>
<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
| <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.set0">set0</a></span> <span class="id">p</span> <span class="id">x</span>)<br/>
| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span>' =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="tactic">set</span>' <span class="id">p</span> <span class="id">x</span> <span class="id">m</span>')<br/>
<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Removal in a nonempty trie produces a possibly empty trie.
    To simplify the code, we use the <span class="bracket"><span class="id">Node</span></span> smart constructor in the
    cases where the result can be empty or nonempty, depending on the
    results of the recursive calls. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">rem</span>' {<span class="id">A</span>} (<span class="id">p</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">m</span>: <span class="id">tree</span>' <span class="id">A</span>) : <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span> :=<br/>
<span class="kwd">match</span> <span class="id">p</span>, <span class="id">m</span> <span class="kwd">with</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">_</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">_</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l</span> <span class="id">_</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span> <span class="id">_</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l</span> <span class="id">r</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">y</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">y</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">rem</span>' <span class="id">q</span> <span class="id">l</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">rem</span>' <span class="id">q</span> <span class="id">l</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l</span> <span class="id">y</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">rem</span>' <span class="id">q</span> <span class="id">l</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span> <span class="id">y</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">rem</span>' <span class="id">q</span> <span class="id">l</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>) (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id">rem</span>' <span class="id">q</span> <span class="id">r</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">y</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">y</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>) (<span class="id">rem</span>' <span class="id">q</span> <span class="id">r</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id">rem</span>' <span class="id">q</span> <span class="id">r</span>)<br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l</span> <span class="id">y</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span><br/>
| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span> <span class="id">y</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">y</span>) (<span class="id">rem</span>' <span class="id">q</span> <span class="id">r</span>)<br/>
<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">This use of <span class="bracket"><span class="id">Node</span></span> causes some run-time overhead, which we eliminate
    by asking Coq to unfold the definition of <span class="bracket"><span class="id">Node</span></span> in <span class="bracket"><span class="id">rem</span>'</span>,
    then simplify the definition.  This is a form of partial evaluation. </div>
<br/>
<span class="kwd">Definition</span> <span class="id">remove</span>' := <span class="kwd">Eval</span> <span class="id">cbv</span> [<span class="id">rem</span>' <span class="id">Node</span>] <span class="kwd">in</span> @<span class="id">rem</span>'.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="PTree.remove">remove</a></span> {<span class="id">A</span>} (<span class="id">p</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>) : <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span> :=<br/>
<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
| <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span>' =&gt; <span class="id">remove</span>' <span class="id">p</span> <span class="id">m</span>'<br/>
<span class="kwd">end</span>.<br/>
<br/>
<h2> Good variable properties for the basic operations </h2>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="PTree.gempty">gempty</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">i</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>), <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="id"><a href="Tries.Canonical.html#PTree.empty">empty</a></span> <span class="id">A</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</div>
<div class="proofscript" id="proof1">
 <span class="tactic">reflexivity</span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="PTree.gss0">gss0</a></span>: <span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">p</span> (<span class="id">x</span>: <span class="id">A</span>), <span class="id">get</span>' <span class="id">p</span> (<span class="id"><a href="Tries.Canonical.html#PTree.set0">set0</a></span> <span class="id">p</span> <span class="id">x</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</div>
<div class="proofscript" id="proof2">
 <span class="tactic">induction</span> <span class="id">p</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>. Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="PTree.gso0">gso0</a></span>: <span class="kwd">forall</span> {<span class="id">A</span>} <span class="id">p</span> <span class="id">q</span> (<span class="id">x</span>: <span class="id">A</span>), <span class="id">p</span>&lt;&gt;<span class="id">q</span> -&gt; <span class="id">get</span>' <span class="id">p</span> (<span class="id"><a href="Tries.Canonical.html#PTree.set0">set0</a></span> <span class="id">q</span> <span class="id">x</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</div>
<div class="proofscript" id="proof3">
&nbsp;<span class="tactic">induction</span> <span class="id">p</span>; <span class="tactic">destruct</span> <span class="id">q</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>; <span class="tactic">try</span> <span class="tactic">apply</span> <span class="id">IHp</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="PTree.gss">gss</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">i</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">x</span>: <span class="id">A</span>) (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>), <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="tactic">set</span> <span class="id">i</span> <span class="id">x</span> <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</div>
<div class="proofscript" id="proof4">
&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">m</span> <span class="kwd">as</span> [|<span class="id">m</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Tries.Canonical.html#PTree.gss0">gss0</a></span>.<br/>
&nbsp;- <span class="id">revert</span> <span class="id">m</span>; <span class="tactic">induction</span> <span class="id">i</span>; <span class="tactic">destruct</span> <span class="id">m</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id"><a href="Tries.Canonical.html#PTree.gss0">gss0</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="PTree.gso">gso</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">i</span> <span class="id">j</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">x</span>: <span class="id">A</span>) (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;<span class="id">i</span> &lt;&gt; <span class="id">j</span> -&gt; <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="tactic">set</span> <span class="id">j</span> <span class="id">x</span> <span class="id">m</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</div>
<div class="proofscript" id="proof5">
&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">m</span> <span class="kwd">as</span> [|<span class="id">m</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;- <span class="tactic">apply</span> <span class="id"><a href="Tries.Canonical.html#PTree.gso0">gso0</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;- <span class="id">revert</span> <span class="id">m</span> <span class="id">j</span> <span class="id">H</span>; <span class="tactic">induction</span> <span class="id">i</span>; <span class="tactic">destruct</span> <span class="id">j</span>,<span class="id">m</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;<span class="id">solve</span> [<span class="tactic">apply</span> <span class="id">IHi</span>; <span class="tactic">congruence</span> | <span class="tactic">apply</span> <span class="id"><a href="Tries.Canonical.html#PTree.gso0">gso0</a></span>; <span class="tactic">congruence</span> | <span class="tactic">congruence</span>].<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="PTree.gNode">gNode</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span>} (<span class="id">i</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">l</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>) (<span class="id">x</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span>) (<span class="id">r</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id">l</span> <span class="id">x</span> <span class="id">r</span>) = <span class="kwd">match</span> <span class="id">i</span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span> =&gt; <span class="id">x</span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">j</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">j</span> <span class="id">l</span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">j</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">j</span> <span class="id">r</span> <span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</div>
<div class="proofscript" id="proof6">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">l</span>, <span class="id">x</span>, <span class="id">r</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>; <span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="PTree.grs">grs</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">i</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>), <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="id"><a href="Tries.Canonical.html#PTree.remove">remove</a></span> <span class="id">i</span> <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</div>
<div class="proofscript" id="proof7">
&nbsp;&nbsp;<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span> <span class="kwd">as</span> [ |<span class="id">m</span>]; <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">remove</span>' <span class="id">i</span> <span class="id">m</span>) <span class="kwd">with</span> (<span class="id">rem</span>' <span class="id">i</span> <span class="id">m</span>).<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">m</span>. <span class="tactic">induction</span> <span class="id">i</span>; <span class="tactic">destruct</span> <span class="id">m</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Tries.Canonical.html#PTree.gNode">gNode</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="PTree.gro">gro</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">i</span> <span class="id">j</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;<span class="id">i</span> &lt;&gt; <span class="id">j</span> -&gt; <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="id"><a href="Tries.Canonical.html#PTree.remove">remove</a></span> <span class="id">j</span> <span class="id">m</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</div>
<div class="proofscript" id="proof8">
&nbsp;&nbsp;<span class="kwd">Local</span> <span class="id">Opaque</span> <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span> <span class="kwd">as</span> [ |<span class="id">m</span>]; <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">remove</span>' <span class="id">j</span> <span class="id">m</span>) <span class="kwd">with</span> (<span class="id">rem</span>' <span class="id">j</span> <span class="id">m</span>).<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">j</span> <span class="id">m</span>. <span class="tactic">induction</span> <span class="id">i</span>; <span class="tactic">destruct</span> <span class="id">j</span>, <span class="id">m</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;<span class="id">solve</span> [ <span class="tactic">congruence</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="tactic">rewrite</span> <span class="id"><a href="Tries.Canonical.html#PTree.gNode">gNode</a></span>; <span class="tactic">auto</span>; <span class="tactic">apply</span> <span class="id">IHi</span>; <span class="tactic">congruence</span> ].<br/>
Qed.</div>
<br/>
<h2> The <span class="bracket"><span class="id">map_filter</span></span> collective operation over tries </h2>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="PTree.MAP_FILTER">MAP_FILTER</a></span>.<br/>
<br/>
<span class="kwd">Variables</span> <span class="id"><a name="PTree.MAP_FILTER.A">A</a></span> <span class="id"><a name="PTree.MAP_FILTER.B">B</a></span>: <span class="kwd">Type</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="PTree.option_map">option_map</a></span> (<span class="id">f</span>: <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.B">B</a></span>) (<span class="id">o</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.A">A</a></span>): <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.B">B</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">o</span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span> =&gt; <span class="id">f</span> <span class="id">a</span> <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">map_filter</span>' (<span class="id">f</span>: <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.B">B</a></span>) (<span class="id">m</span>: <span class="id">tree</span>' <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.A">A</a></span>) : <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.B">B</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id">map_filter</span>' <span class="id">f</span> <span class="id">r</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> (<span class="id">f</span> <span class="id">x</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> (<span class="id">f</span> <span class="id">x</span>) (<span class="id">map_filter</span>' <span class="id">f</span> <span class="id">r</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">map_filter</span>' <span class="id">f</span> <span class="id">l</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">map_filter</span>' <span class="id">f</span> <span class="id">l</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id">map_filter</span>' <span class="id">f</span> <span class="id">r</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l</span> <span class="id">x</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">map_filter</span>' <span class="id">f</span> <span class="id">l</span>) (<span class="id">f</span> <span class="id">x</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span> <span class="id">x</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">map_filter</span>' <span class="id">f</span> <span class="id">l</span>) (<span class="id">f</span> <span class="id">x</span>) (<span class="id">map_filter</span>' <span class="id">f</span> <span class="id">r</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">map_filter</span>'<span class="id">_opt</span> := <span class="kwd">Eval</span> <span class="id">cbv</span> [<span class="id">map_filter</span>' <span class="id">Node</span>] <span class="kwd">in</span> <span class="id">map_filter</span>'.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="PTree.map_filter">map_filter</a></span> (<span class="id">f</span>: <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.B">B</a></span>) (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.A">A</a></span>) : <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.B">B</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span>' =&gt; <span class="id">map_filter</span>'<span class="id">_opt</span> <span class="id">f</span> <span class="id">m</span>'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">gmap_filter</span>':<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">f</span>: <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.B">B</a></span>) (<span class="id">m</span>: <span class="id">tree</span>' <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.A">A</a></span>) (<span class="id">i</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="id">map_filter</span>' <span class="id">f</span> <span class="id">m</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.option_map">option_map</a></span> <span class="id">f</span> (<span class="id">get</span>' <span class="id">i</span> <span class="id">m</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</div>
<div class="proofscript" id="proof9">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">m</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Tries.Canonical.html#PTree.gNode">gNode</a></span>; <span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="PTree.gmap_filter">gmap_filter</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">f</span>: <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.B">B</a></span>) (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.A">A</a></span>) (<span class="id">i</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="id"><a href="Tries.Canonical.html#PTree.map_filter">map_filter</a></span> <span class="id">f</span> <span class="id">m</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.option_map">option_map</a></span> <span class="id">f</span> (<span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> <span class="id">m</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof10')">Proof.</div>
<div class="proofscript" id="proof10">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">m</span> <span class="kwd">as</span> [ | <span class="id">m</span>]; <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">change</span> (<span class="id">map_filter</span>'<span class="id">_opt</span> <span class="id">f</span> <span class="id">m</span>) <span class="kwd">with</span> (<span class="id">map_filter</span>' <span class="id">f</span> <span class="id">m</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">gmap_filter</span>'.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="PTree.unroll_map_filter">unroll_map_filter</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">f</span>: <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.B">B</a></span>) (<span class="id">l</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.A">A</a></span>) (<span class="id">o</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.A">A</a></span>) (<span class="id">r</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER.A">A</a></span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.map_filter">map_filter</a></span> <span class="id">f</span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.map_filter">map_filter</a></span> <span class="id">f</span> <span class="id">l</span>) (<span class="id"><a href="Tries.Canonical.html#PTree.option_map">option_map</a></span> <span class="id">f</span> <span class="id">o</span>) (<span class="id"><a href="Tries.Canonical.html#PTree.map_filter">map_filter</a></span> <span class="id">f</span> <span class="id">r</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof11')">Proof.</div>
<div class="proofscript" id="proof11">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id"><a href="Tries.Canonical.html#PTree.map_filter">map_filter</a></span>. <span class="id">change</span> <span class="id">map_filter</span>'<span class="id">_opt</span> <span class="kwd">with</span> <span class="id">map_filter</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>, <span class="id">o</span>, <span class="id">r</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Tries.Canonical.html#PTree.MAP_FILTER">MAP_FILTER</a></span>.<br/>
<br/>
<h2> Custom case analysis principles and induction principles </h2>
<br/>
<div class="doc">We can view canonical tries as being of one of two (non-exclusive)
    cases: either <span class="bracket"><span class="id">Empty</span></span> for an empty trie, or <span class="bracket"><span class="id">Node</span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span></span> for a
    possibly nonempty trie, with <span class="bracket"><span class="id">l</span></span> and <span class="bracket"><span class="id">r</span></span> the left and right subtrees
    and <span class="bracket"><span class="id">o</span></span> an optional value.  These are exactly the two cases of
    the original implementation of tries (module <span class="bracket"><span class="id">Original</span></span>).
    The <span class="bracket"><span class="id">Empty</span></span> constructor and the <span class="bracket"><span class="id">Node</span></span> smart function defined above
    provide one half of the view: the one that lets us construct values
    of type <span class="bracket"><span class="id">tree</span> <span class="id">A</span></span>.
    We now define the other half of the view: the one that lets us
    inspect and recurse over values of type <span class="bracket"><span class="id">tree</span> <span class="id">A</span></span>.  This is achieved
    by defining appropriate principles for case analysis and induction. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="PTree.not_trivially_empty">not_trivially_empty</a></span> {<span class="id">A</span>} (<span class="id">l</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>) (<span class="id">o</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span>) (<span class="id">r</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span>, <span class="id">o</span>, <span class="id">r</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span>, <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h3> A case analysis principle </h3>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="PTree.TREE_CASE">TREE_CASE</a></span>.<br/>
<br/>
<span class="kwd">Context</span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">empty</span>: <span class="id">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">node</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span> -&gt; <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span> -&gt; <span class="id">B</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="PTree.tree_case">tree_case</a></span> (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE.A">A</a></span>) : <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE.B">B</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE.empty">empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r</span>) =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE.node">node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x</span>) =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE.node">node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x</span> <span class="id">r</span>) =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE.node">node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l</span>) =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE.node">node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l</span> <span class="id">r</span>) =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE.node">node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l</span> <span class="id">x</span>) =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE.node">node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span> <span class="id">x</span> <span class="id">r</span>) =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE.node">node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">In terms of the original implementation of tries, the function
    <span class="bracket"><span class="id">tree_case</span></span> corresponds to a simple pattern matching:
<pre>
    Definition tree_case (m: tree A) : B :=
      match m with Leaf =&gt; empty | Node l o r =&gt; node l o r end.</pre>
</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="PTree.unroll_tree_case">unroll_tree_case</a></span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.not_trivially_empty">not_trivially_empty</a></span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.tree_case">tree_case</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE.node">node</a></span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof12')">Proof.</div>
<div class="proofscript" id="proof12">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>, <span class="id">o</span>, <span class="id">r</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>. <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Alternatively, we can omit the <span class="bracket"><span class="id">not_trivially_empty</span></span> hypothesis
    if the <span class="bracket"><span class="id">node</span></span> case for trivially empty nodes agrees with the <span class="bracket"><span class="id">empty</span></span> case. </div>
<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PTree.TREE_CASE.node_empty">node_empty</a></span>: <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE.node">node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> = <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE.empty">empty</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="PTree.unroll_tree_case_gen">unroll_tree_case_gen</a></span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.tree_case">tree_case</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE.node">node</a></span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof13')">Proof.</div>
<div class="proofscript" id="proof13">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>, <span class="id">o</span>, <span class="id">r</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_CASE">TREE_CASE</a></span>.<br/>
<br/>
<h3> A recursion principle </h3>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="PTree.TREE_REC">TREE_REC</a></span>.<br/>
<br/>
<span class="kwd">Context</span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">empty</span>: <span class="id">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">node</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span> -&gt; <span class="id">B</span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id">A</span> -&gt; <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span> -&gt; <span class="id">B</span> -&gt; <span class="id">B</span>).<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">tree_rec</span>' (<span class="id">m</span>: <span class="id">tree</span>' <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.A">A</a></span>) : <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.B">B</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.node">node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.empty">empty</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>) (<span class="id">tree_rec</span>' <span class="id">r</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.node">node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.empty">empty</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.empty">empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.node">node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.empty">empty</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>) (<span class="id">tree_rec</span>' <span class="id">r</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.node">node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>) (<span class="id">tree_rec</span>' <span class="id">l</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.empty">empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.node">node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>) (<span class="id">tree_rec</span>' <span class="id">l</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>) (<span class="id">tree_rec</span>' <span class="id">r</span>)<br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l</span> <span class="id">x</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.node">node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>) (<span class="id">tree_rec</span>' <span class="id">l</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.empty">empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span> <span class="id">x</span> <span class="id">r</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.node">node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>) (<span class="id">tree_rec</span>' <span class="id">l</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>) (<span class="id">tree_rec</span>' <span class="id">r</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="PTree.tree_rec">tree_rec</a></span> (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.A">A</a></span>) : <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.B">B</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.empty">empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span>' =&gt; <span class="id">tree_rec</span>' <span class="id">m</span>'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">In terms of the original implementation of tries, the function
    <span class="bracket"><span class="id">tree_rec</span></span> corresponds to the basic recursion principle for type
    <span class="bracket"><span class="id">Original.tree</span></span>:
<pre>
    Fixpoint tree_rec (m: tree A) : B :=
      match m with
      | Leaf =&gt; empty
      | Node l o r =&gt; node l (tree_rec l) o r (tree_rec r)
      end.</pre>
</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="PTree.unroll_tree_rec">unroll_tree_rec</a></span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.not_trivially_empty">not_trivially_empty</a></span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.tree_rec">tree_rec</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.node">node</a></span> <span class="id">l</span> (<span class="id"><a href="Tries.Canonical.html#PTree.tree_rec">tree_rec</a></span> <span class="id">l</span>) <span class="id">o</span> <span class="id">r</span> (<span class="id"><a href="Tries.Canonical.html#PTree.tree_rec">tree_rec</a></span> <span class="id">r</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof14')">Proof.</div>
<div class="proofscript" id="proof14">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>, <span class="id">o</span>, <span class="id">r</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">auto</span>. <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PTree.TREE_REC.node_empty">node_empty</a></span>: <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.node">node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.empty">empty</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.empty">empty</a></span> = <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.empty">empty</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="PTree.unroll_tree_rec_gen">unroll_tree_rec_gen</a></span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.tree_rec">tree_rec</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC.node">node</a></span> <span class="id">l</span> (<span class="id"><a href="Tries.Canonical.html#PTree.tree_rec">tree_rec</a></span> <span class="id">l</span>) <span class="id">o</span> <span class="id">r</span> (<span class="id"><a href="Tries.Canonical.html#PTree.tree_rec">tree_rec</a></span> <span class="id">r</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof15')">Proof.</div>
<div class="proofscript" id="proof15">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>, <span class="id">o</span>, <span class="id">r</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_REC">TREE_REC</a></span>.<br/>
<br/>
<h3> An induction principle </h3>
<br/>
<div class="doc">We now define a more general induction principle that supports
    a result type that depends on the argument value.
    This principle is usable both for computations and for proofs. </div>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="PTree.TREE_IND">TREE_IND</a></span>.<br/>
<br/>
<span class="kwd">Context</span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span> -&gt; <span class="kwd">Type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">empty</span>: <span class="id">P</span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">node</span>: <span class="kwd">forall</span> <span class="id">l</span>, <span class="id">P</span> <span class="id">l</span> -&gt; <span class="kwd">forall</span> <span class="id">o</span> <span class="id">r</span>, <span class="id">P</span> <span class="id">r</span> -&gt; <span class="id"><a href="Tries.Canonical.html#PTree.not_trivially_empty">not_trivially_empty</a></span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span>)).<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Fixpoint</span> <span class="id">tree_ind</span>' (<span class="id">m</span>: <span class="id">tree</span>' <span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.A">A</a></span>) : <span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.P">P</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r</span> =&gt; @<span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.node">node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.empty">empty</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>) (<span class="id">tree_ind</span>' <span class="id">r</span>) <span class="id">_</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x</span> =&gt; @<span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.node">node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.empty">empty</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.empty">empty</a></span> <span class="id">_</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x</span> <span class="id">r</span> =&gt; @<span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.node">node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.empty">empty</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>) (<span class="id">tree_ind</span>' <span class="id">r</span>) <span class="id">_</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l</span> =&gt; @<span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.node">node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>) (<span class="id">tree_ind</span>' <span class="id">l</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.empty">empty</a></span> <span class="id">_</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l</span> <span class="id">r</span> =&gt; @<span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.node">node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>) (<span class="id">tree_ind</span>' <span class="id">l</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>) (<span class="id">tree_ind</span>' <span class="id">r</span>) <span class="id">_</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l</span> <span class="id">x</span> =&gt; @<span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.node">node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>) (<span class="id">tree_ind</span>' <span class="id">l</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.empty">empty</a></span> <span class="id">_</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l</span> <span class="id">x</span> <span class="id">r</span> =&gt; @<span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.node">node</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">l</span>) (<span class="id">tree_ind</span>' <span class="id">l</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>) (<span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">r</span>) (<span class="id">tree_ind</span>' <span class="id">r</span>) <span class="id">_</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="PTree.tree_ind">tree_ind</a></span> (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.A">A</a></span>) : <span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.P">P</a></span> <span class="id">m</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND.empty">empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m</span>' =&gt; <span class="id">tree_ind</span>' <span class="id">m</span>'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">tree_ind</span></span> defined above has almost the same type as the
    induction principle automatically derived by Coq for the
    <span class="bracket"><span class="id">Original.tree</span></span> type of the original trie implementation.
    The only difference is that the <span class="bracket"><span class="id">node</span></span> case receives an additional
    hypothesis <span class="bracket"><span class="id">not_trivially_empty</span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span></span>, which is useful to apply
    the <span class="bracket"><span class="id">unroll_tree_case</span></span> and <span class="bracket"><span class="id">unroll_tree_rec</span></span> equations. </div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Tries.Canonical.html#PTree.TREE_IND">TREE_IND</a></span>.<br/>
<br/>
<div class="doc">Example of use: alternate proofs for the <span class="bracket"><span class="tactic">set</span></span> operation. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="PTree.set_Empty">set_Empty</a></span>: <span class="kwd">forall</span> <span class="id">A</span> (<span class="id">v</span>: <span class="id">A</span>) <span class="id">p</span>,<br/>
&nbsp;&nbsp;<span class="tactic">set</span> <span class="id">p</span> <span class="id">v</span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="tactic">set</span> <span class="id">q</span> <span class="id">v</span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="tactic">set</span> <span class="id">q</span> <span class="id">v</span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof16')">Proof.</div>
<div class="proofscript" id="proof16">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="PTree.set_Node">set_Node</a></span>: <span class="kwd">forall</span> <span class="id">A</span> (<span class="id">v</span>: <span class="id">A</span>) <span class="id">l</span> <span class="id">o</span> <span class="id">r</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;<span class="tactic">set</span> <span class="id">p</span> <span class="id">v</span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id">l</span> <span class="id">o</span> <span class="id">r</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id">l</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>) <span class="id">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">q</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="tactic">set</span> <span class="id">q</span> <span class="id">v</span> <span class="id">l</span>) <span class="id">o</span> <span class="id">r</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">q</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id">l</span> <span class="id">o</span> (<span class="tactic">set</span> <span class="id">q</span> <span class="id">v</span> <span class="id">r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof17')">Proof.</div>
<div class="proofscript" id="proof17">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>, <span class="id">o</span>, <span class="id">r</span>, <span class="id">p</span>; <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="PTree.gss_alt_proof">gss_alt_proof</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">i</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">x</span>: <span class="id">A</span>) (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>), <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="tactic">set</span> <span class="id">i</span> <span class="id">x</span> <span class="id">m</span>) = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof18')">Proof.</div>
<div class="proofscript" id="proof18">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">i</span>; <span class="tactic">induction</span> <span class="id">m</span> <span class="kwd">using</span> <span class="id"><a href="Tries.Canonical.html#PTree.tree_ind">tree_ind</a></span>; <span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;(<span class="tactic">rewrite</span> <span class="id"><a href="Tries.Canonical.html#PTree.set_Empty">set_Empty</a></span> || <span class="tactic">rewrite</span> <span class="id"><a href="Tries.Canonical.html#PTree.set_Node">set_Node</a></span>); <span class="tactic">rewrite</span> <span class="id"><a href="Tries.Canonical.html#PTree.gNode">gNode</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="PTree.gso_alt_proof">gso_alt_proof</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">i</span> <span class="id">j</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>) (<span class="id">x</span>: <span class="id">A</span>) (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;<span class="id">i</span> &lt;&gt; <span class="id">j</span> -&gt; <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="tactic">set</span> <span class="id">j</span> <span class="id">x</span> <span class="id">m</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof19')">Proof.</div>
<div class="proofscript" id="proof19">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">i</span>; <span class="tactic">destruct</span> <span class="id">j</span>; <span class="tactic">induction</span> <span class="id">m</span> <span class="kwd">using</span> <span class="id"><a href="Tries.Canonical.html#PTree.tree_ind">tree_ind</a></span>; <span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;(<span class="tactic">rewrite</span> <span class="id"><a href="Tries.Canonical.html#PTree.set_Empty">set_Empty</a></span> || <span class="tactic">rewrite</span> <span class="id"><a href="Tries.Canonical.html#PTree.set_Node">set_Node</a></span>); <span class="tactic">rewrite</span> ! <span class="id"><a href="Tries.Canonical.html#PTree.gNode">gNode</a></span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">IHi</span>); <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<h2> The <span class="bracket"><span class="id">combine</span></span> collective operation over pairs of tries </h2>
<br/>
<span class="kwd">Section</span> <span class="id"><a name="PTree.COMBINE">COMBINE</a></span>.<br/>
<br/>
<span class="kwd">Variables</span> <span class="id"><a name="PTree.COMBINE.A">A</a></span> <span class="id"><a name="PTree.COMBINE.B">B</a></span> <span class="id"><a name="PTree.COMBINE.C">C</a></span>: <span class="kwd">Type</span>.<br/>
<span class="kwd">Variable</span> <span class="id"><a name="PTree.COMBINE.f">f</a></span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.A">A</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.B">B</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.C">C</a></span>.<br/>
<span class="kwd">Hypothesis</span> <span class="id"><a name="PTree.COMBINE.f_None_None">f_None_None</a></span>: <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">combine</span>'<span class="id">_l</span> := <span class="id">map_filter</span>' (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>).<br/>
<span class="kwd">Definition</span> <span class="id">combine</span>'<span class="id">_r</span> := <span class="id">map_filter</span>' (<span class="kwd">fun</span> <span class="id">b</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">b</span>)).<br/>
<br/>
<div class="doc">First definition of <span class="bracket"><span class="id">combine</span>'</span>, done by writing 49 cases (7x7) by hand. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">combine</span>'<span class="id">_direct</span> (<span class="id">m1</span>: <span class="id">tree</span>' <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.A">A</a></span>) (<span class="id">m2</span>: <span class="id">tree</span>' <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.B">B</a></span>) {<span class="kwd">struct</span> <span class="id">m1</span>} : <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.C">C</a></span> :=<br/>
&nbsp;<span class="kwd">let</span> <span class="id">c</span> := <span class="id">combine</span>'<span class="id">_direct</span> <span class="kwd">in</span><br/>
&nbsp;<span class="kwd">let</span> <span class="id">f1</span> <span class="id">x1</span> := <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x1</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="kwd">in</span><br/>
&nbsp;<span class="kwd">let</span> <span class="id">f2</span> <span class="id">x2</span> := <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x2</span>) <span class="kwd">in</span><br/>
&nbsp;<span class="kwd">let</span> <span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span> := <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x1</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x2</span>) <span class="kwd">in</span><br/>
&nbsp;<span class="kwd">let</span> <span class="id">c1</span> := <span class="id">combine</span>'<span class="id">_l</span> <span class="kwd">in</span><br/>
&nbsp;<span class="kwd">let</span> <span class="id">c2</span> := <span class="id">combine</span>'<span class="id">_r</span> <span class="kwd">in</span><br/>
&nbsp;<span class="kwd">match</span> <span class="id">m1</span>, <span class="id">m2</span> <span class="kwd">with</span><br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> (<span class="id">f2</span> <span class="id">x2</span>) (<span class="id">c1</span> <span class="id">r1</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> (<span class="id">f2</span> <span class="id">x2</span>) (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c2</span> <span class="id">l2</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id">c1</span> <span class="id">r1</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c2</span> <span class="id">l2</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l2</span> <span class="id">x2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c2</span> <span class="id">l2</span>) (<span class="id">f2</span> <span class="id">x2</span>) (<span class="id">c1</span> <span class="id">r1</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l2</span> <span class="id">x2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c2</span> <span class="id">l2</span>) (<span class="id">f2</span> <span class="id">x2</span>) (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> (<span class="id">f1</span> <span class="id">x1</span>) (<span class="id">c2</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) (<span class="id">c2</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c2</span> <span class="id">l2</span>) (<span class="id">f1</span> <span class="id">x1</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c2</span> <span class="id">l2</span>) (<span class="id">f1</span> <span class="id">x1</span>) (<span class="id">c2</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l2</span> <span class="id">x2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c2</span> <span class="id">l2</span>) (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l2</span> <span class="id">x2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c2</span> <span class="id">l2</span>) (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) (<span class="id">c2</span> <span class="id">r2</span>)<br/>
<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> (<span class="id">f1</span> <span class="id">x1</span>) (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) (<span class="id">c1</span> <span class="id">r1</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c2</span> <span class="id">l2</span>) (<span class="id">f1</span> <span class="id">x1</span>) (<span class="id">c1</span> <span class="id">r1</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c2</span> <span class="id">l2</span>) (<span class="id">f1</span> <span class="id">x1</span>) (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l2</span> <span class="id">x2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c2</span> <span class="id">l2</span>) (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) (<span class="id">c1</span> <span class="id">r1</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l2</span> <span class="id">x2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c2</span> <span class="id">l2</span>) (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c1</span> <span class="id">l1</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id">c2</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c1</span> <span class="id">l1</span>) (<span class="id">f2</span> <span class="id">x2</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c1</span> <span class="id">l1</span>) (<span class="id">f2</span> <span class="id">x2</span>) (<span class="id">c2</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id">c2</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l2</span> <span class="id">x2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) (<span class="id">f2</span> <span class="id">x2</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l2</span> <span class="id">x2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) (<span class="id">f2</span> <span class="id">x2</span>) (<span class="id">c2</span> <span class="id">r2</span>)<br/>
<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c1</span> <span class="id">l1</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c1</span> <span class="id">l1</span>) (<span class="id">f2</span> <span class="id">x2</span>) (<span class="id">c1</span> <span class="id">r1</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c1</span> <span class="id">l1</span>) (<span class="id">f2</span> <span class="id">x2</span>) (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id">c1</span> <span class="id">r1</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l2</span> <span class="id">x2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) (<span class="id">f2</span> <span class="id">x2</span>) (<span class="id">c1</span> <span class="id">r1</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l2</span> <span class="id">x2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) (<span class="id">f2</span> <span class="id">x2</span>) (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l1</span> <span class="id">x1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c1</span> <span class="id">l1</span>) (<span class="id">f1</span> <span class="id">x1</span>) (<span class="id">c2</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l1</span> <span class="id">x1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c1</span> <span class="id">l1</span>) (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l1</span> <span class="id">x1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c1</span> <span class="id">l1</span>) (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) (<span class="id">c2</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l1</span> <span class="id">x1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) (<span class="id">f1</span> <span class="id">x1</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l1</span> <span class="id">x1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) (<span class="id">f1</span> <span class="id">x1</span>) (<span class="id">c2</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l1</span> <span class="id">x1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l2</span> <span class="id">x2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l1</span> <span class="id">x1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l2</span> <span class="id">x2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) (<span class="id">c2</span> <span class="id">r2</span>)<br/>
<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l1</span> <span class="id">x1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node001">Node001</a></span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c1</span> <span class="id">l1</span>) (<span class="id">f1</span> <span class="id">x1</span>) (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l1</span> <span class="id">x1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node010">Node010</a></span> <span class="id">x2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c1</span> <span class="id">l1</span>) (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) (<span class="id">c1</span> <span class="id">r1</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l1</span> <span class="id">x1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node011">Node011</a></span> <span class="id">x2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c1</span> <span class="id">l1</span>) (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l1</span> <span class="id">x1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node100">Node100</a></span> <span class="id">l2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) (<span class="id">f1</span> <span class="id">x1</span>) (<span class="id">c1</span> <span class="id">r1</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l1</span> <span class="id">x1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node101">Node101</a></span> <span class="id">l2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) (<span class="id">f1</span> <span class="id">x1</span>) (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l1</span> <span class="id">x1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node110">Node110</a></span> <span class="id">l2</span> <span class="id">x2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) (<span class="id">c1</span> <span class="id">r1</span>)<br/>
&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l1</span> <span class="id">x1</span> <span class="id">r1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Node111">Node111</a></span> <span class="id">l2</span> <span class="id">x2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">c</span> <span class="id">l1</span> <span class="id">l2</span>) (<span class="id">f</span>' <span class="id">x1</span> <span class="id">x2</span>) (<span class="id">c</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">We now prove the expected "get-combine" equation for <span class="bracket"><span class="id">combine</span>'<span class="id">_direct</span></span>.
    This is a great way to find mistakes in the definition above. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">gcombine</span>'<span class="id">_l</span>: <span class="kwd">forall</span> <span class="id">m</span> <span class="id">i</span>, <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="id">combine</span>'<span class="id">_l</span> <span class="id">m</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> (<span class="id">get</span>' <span class="id">i</span> <span class="id">m</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof20')">Proof.</div>
<div class="proofscript" id="proof20">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">combine</span>'<span class="id">_l</span>. <span class="tactic">rewrite</span> <span class="id">gmap_filter</span>'. <span class="tactic">destruct</span> (<span class="id">get</span>' <span class="id">i</span> <span class="id">m</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">gcombine</span>'<span class="id">_r</span>: <span class="kwd">forall</span> <span class="id">m</span> <span class="id">i</span>, <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="id">combine</span>'<span class="id">_r</span> <span class="id">m</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id">get</span>' <span class="id">i</span> <span class="id">m</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof21')">Proof.</div>
<div class="proofscript" id="proof21">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">combine</span>'<span class="id">_r</span>. <span class="tactic">rewrite</span> <span class="id">gmap_filter</span>'. <span class="tactic">destruct</span> (<span class="id">get</span>' <span class="id">i</span> <span class="id">m</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">gcombine</span>'<span class="id">_direct</span>: <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="id">combine</span>'<span class="id">_direct</span> <span class="id">m1</span> <span class="id">m2</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> (<span class="id">get</span>' <span class="id">i</span> <span class="id">m1</span>) (<span class="id">get</span>' <span class="id">i</span> <span class="id">m2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof22')">Proof.</div>
<div class="proofscript" id="proof22">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">m1</span>; <span class="tactic">destruct</span> <span class="id">m2</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Tries.Canonical.html#PTree.gNode">gNode</a></span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">gcombine</span>'<span class="id">_l</span>, <span class="id">gcombine</span>'<span class="id">_r</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Second definition of <span class="bracket"><span class="id">combine</span>'</span>, using tactics to fill out the 49 cases. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">combine</span>'<span class="id">_by_tac</span> (<span class="id">m1</span>: <span class="id">tree</span>' <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.A">A</a></span>) (<span class="id">m2</span>: <span class="id">tree</span>' <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.B">B</a></span>) {<span class="kwd">struct</span> <span class="id">m1</span>} : <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.C">C</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof23')">Proof.</div>
<div class="proofscript" id="proof23">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m1</span> <span class="kwd">as</span> [ <span class="id">r1</span> | <span class="id">x1</span> | <span class="id">x1</span> <span class="id">r1</span> | <span class="id">l1</span> | <span class="id">l1</span> <span class="id">r1</span> | <span class="id">l1</span> <span class="id">x1</span> | <span class="id">l1</span> <span class="id">x1</span> <span class="id">r1</span> ];<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m2</span> <span class="kwd">as</span> [ <span class="id">r2</span> | <span class="id">x2</span> | <span class="id">x2</span> <span class="id">r2</span> | <span class="id">l2</span> | <span class="id">l2</span> <span class="id">r2</span> | <span class="id">l2</span> <span class="id">x2</span> | <span class="id">l2</span> <span class="id">x2</span> <span class="id">r2</span> ];<br/>
&nbsp;&nbsp;(<span class="tactic">apply</span> <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span>;<br/>
&nbsp;&nbsp;&nbsp;[ <span class="id">solve</span> [ <span class="tactic">exact</span> (<span class="id">combine</span>'<span class="id">_by_tac</span> <span class="id">l1</span> <span class="id">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="tactic">exact</span> (<span class="id">combine</span>'<span class="id">_l</span> <span class="id">l1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="tactic">exact</span> (<span class="id">combine</span>'<span class="id">_r</span> <span class="id">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="tactic">exact</span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span>]<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">solve</span> [ <span class="tactic">exact</span> (<span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x1</span>) (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="tactic">exact</span> (<span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="tactic">exact</span> (<span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">x1</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>]<br/>
&nbsp;&nbsp;&nbsp;| <span class="id">solve</span> [ <span class="tactic">exact</span> (<span class="id">combine</span>'<span class="id">_by_tac</span> <span class="id">r1</span> <span class="id">r2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="tactic">exact</span> (<span class="id">combine</span>'<span class="id">_l</span> <span class="id">r1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="tactic">exact</span> (<span class="id">combine</span>'<span class="id">_r</span> <span class="id">r2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="tactic">exact</span> <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> ]<br/>
&nbsp;&nbsp;&nbsp;]).<br/>
Defined.</div>
<br/>
<div class="doc">Again, proving the "get-combine" equation for <span class="bracket"><span class="id">combine</span>'<span class="id">_by_tac</span></span>
    brings much confidence that we got the tactics-based definition right.
    The proof script is identical to the proof for <span class="bracket"><span class="id">gcombine</span>'<span class="id">_direct</span></span>,
    which is not surprising in light of the Lemma <span class="bracket"><span class="id">combine</span>'<span class="id">_by_tac_eq</span></span>,
    below! </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">gcombine</span>'<span class="id">_by_tac</span>: <span class="kwd">forall</span> <span class="id">m1</span> <span class="id">m2</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="id">combine</span>'<span class="id">_by_tac</span> <span class="id">m1</span> <span class="id">m2</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> (<span class="id">get</span>' <span class="id">i</span> <span class="id">m1</span>) (<span class="id">get</span>' <span class="id">i</span> <span class="id">m2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof24')">Proof.</div>
<div class="proofscript" id="proof24">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">m1</span>; <span class="tactic">destruct</span> <span class="id">m2</span>; <span class="tactic">intros</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id"><a href="Tries.Canonical.html#PTree.gNode">gNode</a></span>;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">gcombine</span>'<span class="id">_l</span>, <span class="id">gcombine</span>'<span class="id">_r</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Actually, the tactics produced exactly the same definition as
    the one we wrote by hand before. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">combine</span>'<span class="id">_by_tac_eq</span>: <span class="id">combine</span>'<span class="id">_by_tac</span> = <span class="id">combine</span>'<span class="id">_direct</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof25')">Proof.</div>
<div class="proofscript" id="proof25">
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<div class="doc">We can now finish the definition of <span class="bracket"><span class="id">combine</span></span>, adding cases
    for when one or both of the tries are empty. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="PTree.combine">combine</a></span> (<span class="id">m1</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.A">A</a></span>) (<span class="id">m2</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.B">B</a></span>) : <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.C">C</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m1</span>, <span class="id">m2</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span>, <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m2</span> =&gt; <span class="id">combine</span>'<span class="id">_r</span> <span class="id">m2</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span> =&gt; <span class="id">combine</span>'<span class="id">_l</span> <span class="id">m1</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m1</span>, <span class="id"><a href="Tries.Canonical.html#PTree.Nodes">Nodes</a></span> <span class="id">m2</span> =&gt; <span class="id">combine</span>'<span class="id">_by_tac</span> <span class="id">m1</span> <span class="id">m2</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="PTree.gcombine">gcombine</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">m1</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.A">A</a></span>) (<span class="id">m2</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.B">B</a></span>) (<span class="id">i</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="id"><a href="Tries.Canonical.html#PTree.combine">combine</a></span> <span class="id">m1</span> <span class="id">m2</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> <span class="id">m1</span>) (<span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> <span class="id">m2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof26')">Proof.</div>
<div class="proofscript" id="proof26">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">m1</span> <span class="kwd">as</span> [ | <span class="id">m1</span>], <span class="id">m2</span> <span class="kwd">as</span> [ | <span class="id">m2</span>]; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">gcombine</span>'<span class="id">_r</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">gcombine</span>'<span class="id">_l</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">gcombine</span>'<span class="id">_by_tac</span>.<br/>
Qed.</div>
<br/>
<div class="doc">An alternate definition of <span class="bracket"><span class="id">combine</span></span> is possible, using the
    2-constructor view of tries and the custom induction principles
    introduced earlier. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="PTree.combine_view_gen">combine_view_gen</a></span> (<span class="id">m1</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.A">A</a></span>) (<span class="id">m2</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.B">B</a></span>) : <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.C">C</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.tree_rec">tree_rec</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Tries.Canonical.html#PTree.map_filter">map_filter</a></span> (<span class="kwd">fun</span> <span class="id">b</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">b</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">l1</span> <span class="id">lrec</span> <span class="id">o1</span> <span class="id">r1</span> <span class="id">rrec</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.tree_case">tree_case</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id"><a href="Tries.Canonical.html#PTree.map_filter">map_filter</a></span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">a</span>) <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) (<span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id">l1</span> <span class="id">o1</span> <span class="id">r1</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">fun</span> <span class="id">l2</span> <span class="id">o2</span> <span class="id">r2</span> =&gt; <span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> (<span class="id">lrec</span> <span class="id">l2</span>) (<span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> <span class="id">o1</span> <span class="id">o2</span>) (<span class="id">rrec</span> <span class="id">r2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">m1</span> <span class="id">m2</span>.<br/>
<br/>
<div class="doc">The custom principles add a lot of run-time overhead.  Partial evaluation
    can eliminate most (but not all) of this overhead.  </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="PTree.combine_view">combine_view</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">Eval</span> <span class="id">cbv</span> [<span class="id">combine_view_gen</span> <span class="id">tree_rec</span> <span class="id">tree_rec</span>' <span class="id">tree_case</span>] <span class="kwd">in</span> <span class="id"><a href="Tries.Canonical.html#PTree.combine_view_gen">combine_view_gen</a></span>.<br/>
<br/>
<div class="doc">The combine equation can be proved directly on the <span class="bracket"><span class="id">combine_view</span></span>
    implementation, using <span class="bracket"><span class="id">tree_ind</span></span> to perform induction on <span class="bracket"><span class="id">m1</span></span>
    and case analysis on <span class="bracket"><span class="id">m2</span></span>. </div>
<br/>
<span class="kwd">Theorem</span> <span class="id"><a name="PTree.gcombine_view">gcombine_view</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">m1</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.A">A</a></span>) (<span class="id">m2</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.B">B</a></span>) (<span class="id">i</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#positive">positive</a></span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="id"><a href="Tries.Canonical.html#PTree.combine_view">combine_view</a></span> <span class="id">m1</span> <span class="id">m2</span>) = <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE.f">f</a></span> (<span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> <span class="id">m1</span>) (<span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> <span class="id">m2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof27')">Proof.</div>
<div class="proofscript" id="proof27">
&nbsp;&nbsp;<span class="id">change</span> <span class="id"><a href="Tries.Canonical.html#PTree.combine_view">combine_view</a></span> <span class="kwd">with</span> <span class="id"><a href="Tries.Canonical.html#PTree.combine_view_gen">combine_view_gen</a></span>. <span class="tactic">unfold</span> <span class="id"><a href="Tries.Canonical.html#PTree.combine_view_gen">combine_view_gen</a></span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">m1</span> <span class="kwd">using</span> <span class="id"><a href="Tries.Canonical.html#PTree.tree_ind">tree_ind</a></span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Tries.Canonical.html#PTree.gmap_filter">gmap_filter</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> <span class="id">m2</span>); <span class="tactic">auto</span>.<br/>
- <span class="tactic">rewrite</span> <span class="id"><a href="Tries.Canonical.html#PTree.unroll_tree_rec">unroll_tree_rec</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">m2</span> <span class="kwd">using</span> <span class="id"><a href="Tries.Canonical.html#PTree.tree_ind">tree_ind</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id"><a href="Tries.Canonical.html#PTree.gmap_filter">gmap_filter</a></span>. <span class="tactic">destruct</span> (<span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> (<span class="id"><a href="Tries.Canonical.html#PTree.Node">Node</a></span> <span class="id">m1_1</span> <span class="id">o</span> <span class="id">m1_2</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id"><a href="Tries.Canonical.html#PTree.unroll_tree_case">unroll_tree_case</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">rewrite</span> ! <span class="id"><a href="Tries.Canonical.html#PTree.gNode">gNode</a></span>. <span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Tries.Canonical.html#PTree.COMBINE">COMBINE</a></span>.<br/>
<br/>
<h2> Extensionality property </h2>
<br/>
<div class="doc">This is the key property of canonical tries that makes them extensional:
    every <span class="bracket"><span class="id">tree</span>' <span class="id">A</span></span> contains at least one key-value pair. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id">tree</span>'<span class="id">_not_empty</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">m</span>: <span class="id">tree</span>' <span class="id">A</span>), <span class="id">exists</span> <span class="id">i</span>, <span class="id">get</span>' <span class="id">i</span> <span class="id">m</span> &lt;&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof28')">Proof.</div>
<div class="proofscript" id="proof28">
&nbsp;<span class="tactic">induction</span> <span class="id">m</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="tactic">destruct</span> <span class="id">IHm</span> <span class="kwd">as</span> [<span class="id">p</span> <span class="id">H</span>].<br/>
&nbsp;- <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">p</span>); <span class="tactic">auto</span>.<br/>
&nbsp;- <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>; <span class="tactic">simpl</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;- <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>; <span class="tactic">simpl</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;- <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">p</span>); <span class="tactic">auto</span>.<br/>
&nbsp;- <span class="tactic">destruct</span> <span class="id">IHm1</span> <span class="kwd">as</span> [<span class="id">p</span> <span class="id">H</span>]; <span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">p</span>); <span class="tactic">auto</span>.<br/>
&nbsp;- <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>; <span class="tactic">simpl</span>; <span class="tactic">congruence</span>.<br/>
&nbsp;- <span class="id">exists</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>; <span class="tactic">simpl</span>; <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">As a corollary, the only <span class="bracket"><span class="id">tree</span> <span class="id">A</span></span> that contains no key-value pairs
    is <span class="bracket"><span class="id">Empty</span></span>. </div>
<br/>
<span class="kwd">Corollary</span> <span class="id"><a name="PTree.extensionality_empty">extensionality_empty</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">m</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">i</span>, <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> <span class="id">m</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>) -&gt; <span class="id">m</span> = <span class="id"><a href="Tries.Canonical.html#PTree.Empty">Empty</a></span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof29')">Proof.</div>
<div class="proofscript" id="proof29">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">m</span> <span class="kwd">as</span> [ | <span class="id">m</span>]; <span class="tactic">auto</span>. <span class="tactic">destruct</span> (<span class="id">tree</span>'<span class="id">_not_empty</span> <span class="id">m</span>) <span class="kwd">as</span> [<span class="id">i</span> <span class="id">GET</span>].<br/>
&nbsp;&nbsp;<span class="tactic">elim</span> <span class="id">GET</span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Extensionality follows by a simple inductive argument.
    We can use <span class="bracket"><span class="id">tree_ind</span></span> as the induction principle so as to reduce the
    number of cases to consider to 4. </div>
<br/>
<span class="kwd">Theorem</span> <span class="tactic">extensionality</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">m1</span> <span class="id">m2</span>: <span class="id"><a href="Tries.Canonical.html#PTree.tree">tree</a></span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">i</span>, <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> <span class="id">m1</span> = <span class="id"><a href="Tries.Canonical.html#PTree.get">get</a></span> <span class="id">i</span> <span class="id">m2</span>) -&gt; <span class="id">m1</span> = <span class="id">m2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof30')">Proof.</div>
<div class="proofscript" id="proof30">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span>. <span class="tactic">induction</span> <span class="id">m1</span> <span class="kwd">using</span> <span class="id"><a href="Tries.Canonical.html#PTree.tree_ind">tree_ind</a></span>; <span class="tactic">induction</span> <span class="id">m2</span> <span class="kwd">using</span> <span class="id"><a href="Tries.Canonical.html#PTree.tree_ind">tree_ind</a></span>; <span class="tactic">intros</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id"><a href="Tries.Canonical.html#PTree.extensionality_empty">extensionality_empty</a></span>. <span class="tactic">intros</span>; <span class="tactic">symmetry</span>; <span class="tactic">apply</span> <span class="id">H0</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="Tries.Canonical.html#PTree.extensionality_empty">extensionality_empty</a></span>. <span class="tactic">apply</span> <span class="id">H0</span>.<br/>
- <span class="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHm1_1</span>. <span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">H1</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xO">xO</a></span> <span class="id">i</span>)); <span class="tactic">rewrite</span> ! <span class="id"><a href="Tries.Canonical.html#PTree.gNode">gNode</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="id">specialize</span> (<span class="id">H1</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xH">xH</a></span>); <span class="tactic">rewrite</span> ! <span class="id"><a href="Tries.Canonical.html#PTree.gNode">gNode</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHm1_2</span>. <span class="tactic">intros</span>. <span class="id">specialize</span> (<span class="id">H1</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#xI">xI</a></span> <span class="id">i</span>)); <span class="tactic">rewrite</span> ! <span class="id"><a href="Tries.Canonical.html#PTree.gNode">gNode</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">End</span> <span class="id"><a href="Tries.Canonical.html#PTree">PTree</a></span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
